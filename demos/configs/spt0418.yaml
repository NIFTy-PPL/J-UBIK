cpu: False
nonparametric_lens: False
# no_interactive_plotting: False

# Before long run:
# 1) No prior samples
# 2) No interactive plotting
# 3) Frequencies & reference frequency
# 4) No fixed positions
# 5) Large Psf
# 6) Output directory,  res_dir
# 7) (Optional) Download latest webbpsf and delete stashed Psfs: https://webbpsf.readthedocs.io/en/stable/installation.html

jwst_lens_plotting:

  prior_samples: False
  plot_results: True

  share_source_vmin_vmax: True
  source:
    combined:
      vmin: 1.0e-4
      norm: 'log'
    reference:
      vmax: 5
  lens_light:
    combined:
      vmin: 1.0e-4
      vmax: 1.0e+2
      norm: 'log'
    reference:
      vmax: 5

  residuals:
    xmax_residuals: 20 # 4 for big run
    residual_over_std: True
    residual_overplot: 
      max_percent_contours: [0.3, 0.4, 0.5, 0.6, 0.7, 0.8]
      contour_settings: 
        alpha: 0.5
        colors: 'black'
        linewidths: 0.5

    sky: 
      vmin: 1.0e-4
      norm: 'log'
    data:
      vmin: 1.0e-3
      norm: 'log'
    residual:
      vmin: Null # -3, Null
      vmax: Null # -3, Null
      norm: Null
      cmap: 'RdBu_r'


sky: 
  grid:
    # sdim: 512
    sdim: 256
    # NOTE: SHOULD THIS BE HERE?????
    s_padding_ratio: 1.5  # Size of the convergence, i.e. (384*1.5, 6*1.5)

    # fov: 6.0arcsec
    fov: 5.0arcsec
    rotation: 0.0deg
    coordinate_frame: icrs
    sky_center:
      ra: 64.66543063107049deg
      dec: -47.86462563973049deg

    source_grid:
      # sdim: 384
      sdim: 192
      fov: 3arcsec
      s_padding_ratio: 1.0
      # interpolation: 'finufft' # finufft, bilinear
      interpolation: 'bilinear' # finufft, bilinear

    energy_unit: eV
    energy_bin:
      e_min:
        # - 0.054 # F2100W

        # - 0.068 # F1800W  # mistake here actually 0.064

        # - 0.075 # F1500W
        # - 0.093 # F1280W  # mistake here actually 0.088
        # - 0.114 # F1000W
        - 0.143 # F770W
        - 0.201 # F560W

        - 0.249 # F444W

        # - 0.319 # F356W  # mistake here actually 0.311
        # - 0.396 # F277W
        # - 0.557 # F200W
        # - 0.743 # F150W

        # - 0.967 # F115W
      e_max:
        # - 0.067 # F2100W

        # - 0.075 # F1800W

        # - 0.092 # F1500W
        # - 0.107 # F1280W
        # - 0.137 # F1000W
        - 0.188 # F770W
        - 0.245 # F560W

        - 0.319 # F444W

        # - 0.395 # F356W
        # - 0.512 # F277W
        # - 0.707 # F200W
        # - 0.932 # F150W

        # - 1.224 # F115W
      reference_bin: 0 # F444W


  model:
    source:
      light:
        mean:
          gaussian_01: # i0*Gauss
            i0: ['delta', 1.0, 0.0]
            # i0: ['log_normal', 1.0e-1, 2.0e-1]
            center: ['normal', 0, 0.1]
            covariance: ['log_normal', 0.08, 0.05]
            off_diagonal: ['normal', 0.0, 10.0]
          gaussian_02: # i0*Gauss
            i0: ['delta', 1.0, 0.0]
            # i0: ['log_normal', 2.0e-2, 4.0e-2]
            center: ['normal', [-0.5, -0.5], 0.1]
            covariance: ['log_normal', 0.08, 0.05]
            off_diagonal: ['normal', 0.0, 10.0]

        multifrequency:
          nifty_mf:
            zero_mode: [0.2, 0.05] # normal
            spatial_amplitude:
              model: 'matern'
              scale: [0.1, 0.03]        # lognormal
              cutoff: [0.08, 0.01]       # lognormal
              loglogslope: [-4.0, 0.5]  # normal
            spectral_amplitude:
              model: 'matern'
              scale: [0.1, 0.03]        # lognormal
              cutoff: [0.08, 0.01]       # lognormal
              loglogslope: [-4.0, 0.5]  # normal
            spectral_index:
              mean: [-1.5, 0.5]         # normal
              fluctuations: [0.1, 0.05]  # lognormal 
            spectral_deviations:
              process: 'wiener'
              sigma: [5.0e-2, 5.0e-3]  # lognormal

    lens:
      light:
        mean:
          sersic_01: # i0*exp(-bn * (r/re)**1/n - 1)
            ie: ['lognormal', 10.0, 1000.0, [3, 1, 1]]
            # ie: ['delta', 1.0, 0.0]
            re: ['log_normal', 0.4, 0.5]  # 0.88+-0.01 (Jared Cathey et.al. 2023)
            n: ['log_normal', 6.2, 0.6]    # 3.17+-0.02 (Jared Cathey et.al. 2023)
            center: ['normal', [0.0, 0.0], 0.1]
            q: [ 'uniform', 0.8, 1.0]
            theta: ['normal', 0.0, 10.0]
        multifrequency:
          spectral_expand: Null

          # nifty_mf:
          #   zero_mode: [-2.7, 0.8] # normal
          #   spatial_amplitude:
          #     model: 'matern'
          #     scale: [0.01, 0.001]    # lognormal
          #     cutoff: [0.1, 0.01]       # lognormal
          #     loglogslope: [-7.0, 0.2]  # normal
          #   # spectral_amplitude:
          #   #   model: 'matern'
          #   #   scale: [0.08, 0.01]        # lognormal
          #   #   cutoff: [0.1, 0.01]       # lognormal
          #   #   loglogslope: [-4.0, 0.1]  # normal
          #   spectral_index:
          #     mean: [1.4, 0.5]         # normal
          #     fluctuations: [1.0e-2, 1.0e-2]  # lognormal 
          #   spectral_deviations:
          #     process: 'wiener'
          #     sigma: [0.01, 0.01]  # lognormal


      convergence:
        mean:

          # cpl:
          #   b:
          #     distribution: 'log_normal'
          #     mean: 1.3
          #     sigma: 0.1
          #   t:
          #     distribution: 'log_normal'
          #     mean: 0.5
          #     sigma: 0.05
          #   rs:
          #     distribution: 'log_normal'
          #     mean: 0.1
          #     sigma: 0.05
          #   center:
          #     distribution: 'delta'
          #     mean: [0.03696488, -0.03839332] # 0.0
          #     sigma: 0.1
          #   q:
          #     distribution: 'uniform'
          #     min: 1.0
          #     max: 1.25
          #   theta:
          #     distribution: 'normal'
          #     mean: 0.0
          #     sigma: 10

          # dpie:
          #   b:
          #     distribution: 'log_normal'
          #     mean: 2.5
          #     sigma: 0.5
          #   rs:
          #     distribution: 'log_normal'
          #     mean: 0.1
          #     sigma: 0.05
          #   rc:
          #     distribution: 'log_normal'
          #     mean: 0.7
          #     sigma: 0.1
          #   center:
          #     distribution: 'delta'
          #     mean: [0.03696488, -0.03839332] # 0.0
          #     sigma: 0.1
          #   q:
          #     distribution: 'uniform'
          #     min: 1.0
          #     max: 1.25
          #   theta:
          #     distribution: 'normal'
          #     mean: 0.0
          #     sigma: 10

          piemd:
            b:
              distribution: 'log_normal'
              mean: 1.3
              sigma: 0.1
            rs:
              distribution: 'log_normal'
              mean: 0.1
              sigma: 0.05
            center:
              distribution: 'delta'
              mean: [0.03696488, -0.03839332] # 0.0
              sigma: 0.1
            q:
              distribution: 'uniform'
              min: 1.0
              max: 1.25
            theta:
              distribution: 'normal'
              mean: 0.0
              sigma: 10

        perturbations: 
          cfm:
            amplitude:
              offset_mean: 0.0
              offset_std:
                - 1.e-1
                - 1.e-6
            fluctuations:
              fluctuations:
                - 0.5
                - 5.e-2
              loglogavgslope:
                - -6.0
                - 0.9
              flexibility:
                - 0.5
                - 1.0
              asperity: null
                # - 0.1
                # - 0.5

      deflection:
        poisson_padding: 2
        shear:
          shear:
            strength:
              distribution: 'normal'
              mean: 0
              sigma: 0.001
            theta:
              distribution: 'normal'
              mean: 0.0
              sigma: 10
            center:
              distribution: null
              mean: 0.
              sigma: 0.2


telescope:
  corner_mask_01:
    ra: [4h18m39.42s, 4h18m39.46s, 4h18m39.46s, 4h18m39.41s]
    dec: [-47d51m52.3s, -47d51m52.4s, -47d51m53.3s, -47d51m53.2s]

  corner_mask_02:
    ra : [4h18m39.59s, 4h18m39.61s, 4h18m39.59s, 4h18m39.58s]
    dec: [-47d51m54.6s, -47d51m54.9s, -47d51m54.9s, -47d51m54.7s]

  # Center mask
  corner_mask_03:
    ra : [4h18m39.692s, 4h18m39.663s, 4h18m39.68s, 4h18m39.70s]
    dec: [-47d51m52.494s, -47d51m52.629s, -47d51m52.9s, -47d51m52.8s]


  psf:
    webbpsf_path: './data/JWST/WebbPsf/webbpsf-data-LATEST/'
    psf_library: './data/JWST/psf_library'
    psf_arcsec_extension: 3.5
    # psf_arcsec_extension: 0.5

  zero_flux:
    default: ['lognormal', 0.9, 4]

    f444w: ['lognormal', 0.5, 1.5]
    f560w: ['lognormal', 1.5, 1.5]
    f770w: ['lognormal', 4.0, 1.5]
    f1000w: ['lognormal', 14.0, 1.5]
    f1280w: ['lognormal', 25.0, 1.5]
    f1500w: ['lognormal', 43.0, 1.5]
    f1800w: ['lognormal', 92.0, 1.5]
    f2100w: ['lognormal', 226.0, 1.0]

  # gaia_alignment:
  #   subsample: 1
  #   fov: 3.5arcsec
  #   star_light: ['lognormal', 1000, 10000]
  #   library_path: './data/GAIA/library_stars'
  #   exclude_source_id: [4788834899488736128]  # , 4788858367190047104]

  variable_covariance: 
    multiplicative_std_value: ['lognormal', 1., 0.5]

  target: 
    subsample: 3

  hot_pixel:
    sigma: 5
    mask_at_step: 4

  rotation_and_shift:
    # nufft: 
    #   mode: 'constant'

    linear:
      mode: 'constant'
      order: 1

    correction_priors:
      model: 'shift' # shift, rshift
      rotation_unit: deg
      shift_unit: arcsec
      default:
        rotation: ['normal', 0, 10.0]  # With great power comes great responsibility !!
        shift: ['normal', 0, 0.2]

      # # Negative
      # f2100w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.06154776900111457, -0.10477283315652058], [-0.04943149706237294, -0.09895391367023908], [-0.07870863353494717, -0.1248305003569439], [-0.11946144475391586, -0.1014219403620494], [-0.08709179191845064, -0.18665017830253097], [-0.06996130092057268, -0.118942876943854], [-0.06093906748524685, -0.11641996264373873], [-0.07467323482713456, -0.15287663886928932], [-0.09148359337521311, -0.1442639398326269], [-0.08964231400746431, -0.16391357647578758], [-0.12330866248328792, -0.14212357890905966], [-0.06824529348452418, -0.1156124173356846]], 0.05]
      # f1800w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[0.01592818032909945, -0.15674557913897116], [0.03610215501230834, -0.17276120865196598], [0.02429363869019536, -0.19744014449040587], [-0.015600441066292298, -0.16759009986409845]], 0.05]
      # f1500w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.09332490899889137, -0.12697414497102755], [-0.09524076220669332, -0.1168196125624089], [-0.07351610695135077, -0.15236027497222818], [-0.12472473343327956, -0.1512240511250681]], 0.05]
      # f1280w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.0802646799558989, -0.08767055394690498], [-0.07620312408918536, -0.09312867732031867], [-0.0703334709929937, -0.10844387068143126], [-0.07753305588578371, -0.08958382618016167]], 0.05]
      # f1000w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.03465400304463584, -0.14209871752029712], [-0.045403818823522984, -0.15392269088856525], [-0.036924800666415736, -0.15677350143905713], [-0.05065591060206029, -0.15892214706107036]], 0.05]
      # f770w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.11881012432700624, -0.10880757420914876], [-0.11624718557983757, -0.1003752347404141], [-0.1116049146689474, -0.10741249614157086], [-0.11310929070071474, -0.11163422999066921]], 0.05]
      # f560w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.08002436807137103, -0.1140438995994067], [-0.07246153206806977, -0.11164901798498021], [-0.06852599799264492, -0.12163549977929167], [-0.06706153378665099, -0.11192373216949984]], 0.05]
      # f444w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[0.0016144358221124007, -0.17906458578454423], [0.00789682607447599, -0.1819706958050687]], 0.05]
      # f356w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.12009081952695916, -0.052107835134461544], [-0.11131914817189452, -0.0560070774605367]], 0.05]
      # f277w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.16138396053892176, 0.006081327385108519], [-0.15299047519738154, 0.002651220573278105]], 0.05]
      # f200w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.06353870169008952, -0.13170755780809543], [-0.05315495440167009, -0.13325191167806208]], 0.05]
      # f150w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.14042915570486164, -0.04987938579455192], [-0.1296545966005968, -0.051892357948822174]], 0.05]
      # f115w:
      #   rotation: ['delta', 0.0, 0.1]
      #   shift: ['normal', [[-0.08335491172272827, 0.025372893161810038], [-0.07242696738179352, 0.02105995447318984]], 0.05]

      #positive
      f2100w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[-0.03956617483000853, 0.07014227406861445], [-0.0274499028912669, 0.07596119355489596], [-0.05672703936384113, 0.05008460686819114], [-0.09747985058280982, 0.07349316686308563], [-0.0651101977473446, -0.011735071077395937], [-0.04797970674946663, 0.05597223028128103], [-0.03895747331414081, 0.058495144581396305], [-0.05269164065602852, 0.022038468355845706], [-0.06950199920410707, 0.030651167392508137], [-0.06766071983635827, 0.011001530749347455], [-0.10132706831218188, 0.03279152831607537], [-0.04626369931341814, 0.059302689889450436]], [[0.013997271567553121, 0.017764155200965335], [0.03436079016071126, 0.010223906973161088], [0.015860196537493244, 0.01295279739742436], [0.01366938524831634, 0.010587998707577281], [0.016671152181549624, 0.01961631764764601], [0.020950257421157744, 0.01888959563570566], [0.011274058219746174, 0.019443319856754186], [0.03336502801206624, 0.014174101441711722], [0.02349406062646164, 0.015399080429605156], [0.030190662432567097, 0.011747363068990402], [0.017252529941427463, 0.015251706107890511], [0.012066118058799306, 0.007251972712370219]]]
      f1800w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[-0.1182394292230973, 0.0938575935397771], [-0.09806545453988841, 0.0778419640267823], [-0.1098739708620014, 0.053163028188342384], [-0.14976805061848905, 0.08301307281464981]], [[0.013774545173612086, 0.01300704171880682], [0.017634741043828894, 0.016147217911528133], [0.028138285967229823, 0.014628237452819649], [0.0233519887623286, 0.015258175156535934]]]
      f1500w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[-0.12782079058811466, 0.048427611241862], [-0.1297366437959166, 0.05858214365048066], [-0.10801198854057406, 0.023041481240661382], [-0.15922061502250284, 0.02417770508782148]], [[0.006659101838813043, 0.008414579360288605], [0.007550009516378941, 0.013353382596546535], [0.011997049325872453, 0.007162986433368459], [0.006155498837825095, 0.012278318417790453]]]
      f1280w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[-0.09802745281520642, 0.07080476348842868], [-0.09396589694849289, 0.065346640115015], [-0.08809624385230119, 0.050031446753902406], [-0.09529582874509121, 0.068891491255172]], [[0.006502536079796663, 0.006731110756518923], [0.008005762570179095, 0.014819701647635271], [0.006091001411848492, 0.005414773592616199], [0.00482099382741265, 0.005141952755260028]]]
      f1000w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[-0.09948538522734965, 0.08848385554354642], [-0.1102352010062368, 0.07665988217527828], [-0.10175618284912955, 0.0738090716247864], [-0.1154872927847741, 0.07166042600277317]], [[0.005848836149854517, 0.00733766202787366], [0.004938076540048736, 0.009988233476616652], [0.0076963587486197785, 0.006405927046437067], [0.006354529700190472, 0.012155324260058848]]]
      f770w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['normal', [[-0.08494031992774391, -0.020563534996842853], [-0.08035176722837914, -0.010904773999876612], [-0.07594576203302447, -0.023674765102612218], [-0.07986607714779183, -0.024365848661406342]], [[0.0052088348807380475, 0.0022138221134832222], [0.0030564469696875074, 0.0015450689193218902], [0.0038067025503688862, 0.0020647833560859708], [0.0049215050118065025, 0.001951002903078625]]]
      f560w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[-0.1000430551667244, -0.021057003792485207], [-0.0940316235734705, -0.0208735456639736], [-0.09195850856135618, -0.03298818973405727], [-0.09054356144137507, -0.021008619109278676]], [[0.0029802096441146294, 0.006144172131781523], [0.0028310880248907646, 0.00352236771434132], [0.001355310793322407, 0.004111864049609819], [0.001909435779014176, 0.0032250157935673793]]]
      f444w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[0.0016144358221124007, -0.17906458578454423], [0.00789682607447599, -0.1819706958050687]], [[0.0024433106793583974, 0.0024882452965104074], [0.0019459685636701509, 0.0026223648819971627]]]
      f356w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[0.07960940126675642, -0.06049765404716316], [0.08838107262182106, -0.06439689637323831]], [[0.0021621009904632935, 0.005680741974124235], [0.0022989892213084923, 0.005251310591331156]]]
      f277w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[0.08401706171317921, -0.05627606438364136], [0.09241054705471943, -0.05970617119547178]], [[0.0011104745879689558, 0.0015883136761997722], [0.0011007036820057307, 0.0012560470416088207]]]
      f200w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[0.0412548642079675, 0.10724154025833063], [0.05163861149638692, 0.10569718638836398]], [[0.0039090323168607995, 0.003249510935752026], [0.004036227080188099, 0.0031223352958553146]]]
      f150w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[0.11903328246542172, 0.03085948860908197], [0.12980784156968656, 0.028846516454811715]], [[0.0017793583444056886, 0.0028849793211946605], [0.0018801014194138419, 0.0024355790368401297]]]
      f115w:
        rotation: ['delta', 0.0, 0.1]
        shift: ['delta', [[0.058641163404258644, -0.030113231533873415], [0.0695691077451934, -0.03442617022249361]], [[0.004070489833065733, 0.004040306307709968], [0.004020123503218069, 0.003926875611872111]]]



files:
  loading_mode: 'threads' # processes, threads, serial
  # workers: 4

  set_filter: False
  # res_dir: './results/jwst_lens/cluster/22_03_{filter}_positiveDelta_piemd'
  res_dir: './results/jwst_lens/cluster/22_05_f444wf560wf770w_masking_03'

  step_type: 'cleanflickernoisestep'  # tweakregstep, cleanflickernoisestep, cal

  filter:

    # f2100w:
    #   - './data/spt0418/f2100w/jw01355015001_15101_00001_mirimage/jw01355015001_15101_00001_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00002_mirimage/jw01355015001_15101_00002_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00003_mirimage/jw01355015001_15101_00003_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00004_mirimage/jw01355015001_15101_00004_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00005_mirimage/jw01355015001_15101_00005_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00006_mirimage/jw01355015001_15101_00006_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00007_mirimage/jw01355015001_15101_00007_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00008_mirimage/jw01355015001_15101_00008_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00009_mirimage/jw01355015001_15101_00009_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00010_mirimage/jw01355015001_15101_00010_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00011_mirimage/jw01355015001_15101_00011_mirimage_{step_type}.fits'
    #   - './data/spt0418/f2100w/jw01355015001_15101_00012_mirimage/jw01355015001_15101_00012_mirimage_{step_type}.fits'

    # f1800w:
    #   - './data/spt0418/f1800w/jw01355015001_13101_00001_mirimage/jw01355015001_13101_00001_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1800w/jw01355015001_13101_00002_mirimage/jw01355015001_13101_00002_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1800w/jw01355015001_13101_00003_mirimage/jw01355015001_13101_00003_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1800w/jw01355015001_13101_00004_mirimage/jw01355015001_13101_00004_mirimage_{step_type}.fits'

    # f1500w:
    #   - './data/spt0418/f1500w/jw01355015001_11101_00001_mirimage/jw01355015001_11101_00001_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1500w/jw01355015001_11101_00002_mirimage/jw01355015001_11101_00002_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1500w/jw01355015001_11101_00003_mirimage/jw01355015001_11101_00003_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1500w/jw01355015001_11101_00004_mirimage/jw01355015001_11101_00004_mirimage_{step_type}.fits'

    # f1280w:
    #   - './data/spt0418/f1280w/jw01355015001_09101_00001_mirimage/jw01355015001_09101_00001_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1280w/jw01355015001_09101_00002_mirimage/jw01355015001_09101_00002_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1280w/jw01355015001_09101_00003_mirimage/jw01355015001_09101_00003_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1280w/jw01355015001_09101_00004_mirimage/jw01355015001_09101_00004_mirimage_{step_type}.fits'

    # f1000w:
    #   - './data/spt0418/f1000w/jw01355015001_07101_00001_mirimage/jw01355015001_07101_00001_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1000w/jw01355015001_07101_00002_mirimage/jw01355015001_07101_00002_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1000w/jw01355015001_07101_00003_mirimage/jw01355015001_07101_00003_mirimage_{step_type}.fits'
    #   - './data/spt0418/f1000w/jw01355015001_07101_00004_mirimage/jw01355015001_07101_00004_mirimage_{step_type}.fits'

    f770w:
      - './data/spt0418/f770w/jw01355015001_05101_00001_mirimage/jw01355015001_05101_00001_mirimage_{step_type}.fits'
      - './data/spt0418/f770w/jw01355015001_05101_00002_mirimage/jw01355015001_05101_00002_mirimage_{step_type}.fits'
      - './data/spt0418/f770w/jw01355015001_05101_00003_mirimage/jw01355015001_05101_00003_mirimage_{step_type}.fits'
      - './data/spt0418/f770w/jw01355015001_05101_00004_mirimage/jw01355015001_05101_00004_mirimage_{step_type}.fits'

    f560w: # MIRI
      - './data/spt0418/f560w/jw01355015001_03101_00001_mirimage/jw01355015001_03101_00001_mirimage_{step_type}.fits'
      - './data/spt0418/f560w/jw01355015001_03101_00002_mirimage/jw01355015001_03101_00002_mirimage_{step_type}.fits'
      - './data/spt0418/f560w/jw01355015001_03101_00003_mirimage/jw01355015001_03101_00003_mirimage_{step_type}.fits'
      - './data/spt0418/f560w/jw01355015001_03101_00004_mirimage/jw01355015001_03101_00004_mirimage_{step_type}.fits'

    f444w: # NIRCam
      - './data/spt0418/f444w/jw01355016001_02105_00001_nrcblong/jw01355016001_02105_00001_nrcblong_{step_type}.fits'
      - './data/spt0418/f444w/jw01355016001_02105_00002_nrcblong/jw01355016001_02105_00002_nrcblong_{step_type}.fits'

    # f356w:
    #   - './data/spt0418/f356w/jw01355016001_02103_00001_nrcblong/jw01355016001_02103_00001_nrcblong_{step_type}.fits'
    #   - './data/spt0418/f356w/jw01355016001_02103_00002_nrcblong/jw01355016001_02103_00002_nrcblong_{step_type}.fits'

    # f277w:
    #   - './data/spt0418/f277w/jw01355016001_02101_00001_nrcblong/jw01355016001_02101_00001_nrcblong_{step_type}.fits'
    #   - './data/spt0418/f277w/jw01355016001_02101_00002_nrcblong/jw01355016001_02101_00002_nrcblong_{step_type}.fits'

    # f200w:
    #   - './data/spt0418/f200w/jw01355016001_02105_00001_nrcb4/jw01355016001_02105_00001_nrcb4_{step_type}.fits'
    #   - './data/spt0418/f200w/jw01355016001_02105_00002_nrcb4/jw01355016001_02105_00002_nrcb4_{step_type}.fits'

    # f150w:
    #   - './data/spt0418/f150w/jw01355016001_02103_00001_nrcb4/jw01355016001_02103_00001_nrcb4_{step_type}.fits'
    #   - './data/spt0418/f150w/jw01355016001_02103_00002_nrcb4/jw01355016001_02103_00002_nrcb4_{step_type}.fits'

    # f115w: # NIRCam
    #   - './data/spt0418/f115w/jw01355016001_02101_00001_nrcb4/jw01355016001_02101_00001_nrcb4_{step_type}.fits'
    #   - './data/spt0418/f115w/jw01355016001_02101_00002_nrcb4/jw01355016001_02101_00002_nrcb4_{step_type}.fits'


minimization_fixpointing:
    # resume_from_pickle_path: './results/jwst_lens/cluster/19_03_f150w_maskcenter/fixpointing/psf/last.pkl'
    key: 20250530
    resume: True
    n_total_iterations: 1

    delta:
      switches: [0]
      values: [1.e-10]

    samples:
      switches: [0, 2]
      n_samples: [4, 5]
      mode: [linear_resample, nonlinear_resample]

      # lin_absdelta: [Null, Null, 0.00001]
      lin_maxiter: [1000, 2500]
      lin_miniter: [10, 10]

      # nonlin_xtol: [Null, 0.1, 0.01]
      nonlin_maxiter: [7, 7, 13, 18]
      # nonlin_cg_atol: [0.1, 0.01]
      # nonlin_cg_maxiter: [20, 30]

    kl_minimization:
      switches: [0, 10, 15]
      # kl_absdelta: [Null, 1.0e-2, 1.0e-4]
      kl_xtol: 1.0e-12
      kl_maxiter: [15, 20, 25]


minimization:
    key: 20250602
    resume: True
    n_total_iterations: 12

    delta:
      switches: [0, 4, 8, 15]
      values: [5.e-6, 1.e-6, 5.e-7, 1.e-7]

    samples:
      switches: [0, 4, 6, 8, 15]
      n_samples: [3, 3, 5, 5, 5]
      # n_samples: [5]
      # mode: [linear_resample, nonlinear_resample, nonlinear_resample, nonlinear_update]
      mode: [linear_resample, linear_resample, linear_resample, nonlinear_resample]
      # Possible modes:
      # - "linear_sample",
      # - "linear_resample",
      # - "nonlinear_sample",
      # - "nonlinear_resample",
      # - "nonlinear_update",


      # lin_absdelta: [Null, Null, 0.00001]
      lin_maxiter: [120, 350, 650, 1200, 2350]

      # nonlin_xtol: [Null, 0.1, 0.01]
      nonlin_maxiter: [7, 7, 13, 18]
      # nonlin_cg_atol: [0.1, 0.01]
      # nonlin_cg_maxiter: [20, 30]

    kl_minimization:
      switches: [0, 10, 15]
      # kl_absdelta: [Null, 1.0e-2, 1.0e-4]
      kl_xtol: 1.0e-12
      kl_maxiter: [15, 20, 25]
